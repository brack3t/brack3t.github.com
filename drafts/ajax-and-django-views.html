<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Ajax and Django Views [ brack3t ]</title>
    <meta name="description" content="">
    <meta name="author" content="Brack3t, aka Kenneth Love and Chris Jones">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href=".././feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="brack3t ATOM Feed">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="http://fonts.googleapis.com/css?family=Exo:200,300,500,700,900,200italic,300italic,500italic,700italic,900italic" rel="stylesheet">
    <link href=".././brack3t-theme/assets/bootstrap/css/bootstrap.css" rel="stylesheet">
    <link href=".././brack3t-theme/assets/github.css" rel="stylesheet">
    <link href=".././brack3t-theme/assets/bootstrap/css/brack3t.css" rel="stylesheet">
    <script>
    var _gaq = _gaq || [];
    _gaq.push(["_setAccount", "UA-4642386-4"]);
    _gaq.push(["_trackPageview"]);

    (function() {
        var ga = document.createElement("script"); ga.type = "text/javascript"; ga.async = true;
        ga.src = ("https:" == document.location.protocol ? "https://ssl" : "http://www") + ".google-analytics.com/ga.js";
        var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(ga, s);
    })();
</script>
	
<script type="text/javascript">
	var disqus_identifier = "ajax-and-django-views.html";
	(function() {
		var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
		dsq.src = 'http://brack3t.disqus.com/embed.js';
		(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	})();
</script>

  </head>

  <body>

    <div class="container">
        <div class="row-fluid">
            <div class="span5">
                <header id="logo" role="banner">
                    <h1><a href="/">Brack3t</a></h1>
                    <h6>Two guys... and Python.</h6>
                </header>
            </div>
            <aside class="span2" id="sidebar" role="complementary">
                <nav>
                    <ul class="unstyled">
                        
                        
                            
                            <li><a href=".././pages/about-us.html">About</a></li>
                            
                        
                        <li><a href=".././pages/projects.html">Projects</a></li>
                        <li><a href=".././archives.html">Archives</a></li>
                        <li><a href=".././tags.html">Tags</a></li>
                    </ul>
                </nav>
            </aside>
        </div>

        <div class="row-fluid">
            <div class="span7" id="main" role="main">
                
                
    <article>
        <header>
            <h1><span class="slabtext">Ajax and Django Views</span></h1>
            <h6><span class="permalink">Published: <a  href=".././ajax-and-django-views.html">03-12-2012</a></span>
<span class="author">by <strong>Chris</strong></span>
<span class="tags">tags: <a href=".././tag/django.html">django</a> <a href=".././tag/ajax.html">ajax</a> <a href=".././tag/jquery.html">jquery</a> </span>

</h6>
        </header>
        <div class="section" id="django-automatic-csrf">
<h2>Django automatic CSRF</h2>
<p><a class="reference external" href="https://docs.djangoproject.com/en/dev/ref/contrib/csrf/#ajax">https://docs.djangoproject.com/en/dev/ref/contrib/csrf/#ajax</a></p>
</div>
<div class="section" id="ajax-form-field-errors">
<h2>Ajax &amp; Form Field Errors</h2>
<div class="highlight"><pre><span class="kd">function</span> <span class="nx">apply_form_field_error</span><span class="p">(</span><span class="nx">fieldname</span><span class="p">,</span> <span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">input</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#id_&quot;</span> <span class="o">+</span> <span class="nx">fieldname</span><span class="p">),</span>
        <span class="nx">container</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#div_id_&quot;</span> <span class="o">+</span> <span class="nx">fieldname</span><span class="p">),</span>
        <span class="nx">error_msg</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;&lt;span /&gt;&quot;</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s2">&quot;help-inline ajax-error&quot;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="nx">error</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>

    <span class="nx">container</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="s2">&quot;error&quot;</span><span class="p">);</span>
    <span class="nx">error_msg</span><span class="p">.</span><span class="nx">insertAfter</span><span class="p">(</span><span class="nx">input</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">clear_form_field_errors</span><span class="p">(</span><span class="nx">form</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.ajax-error&quot;</span><span class="p">,</span> <span class="nx">$</span><span class="p">(</span><span class="nx">form</span><span class="p">)).</span><span class="nx">remove</span><span class="p">();</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.error&quot;</span><span class="p">,</span> <span class="nx">$</span><span class="p">(</span><span class="nx">form</span><span class="p">)).</span><span class="nx">removeClass</span><span class="p">(</span><span class="s2">&quot;error&quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">django_message</span><span class="p">(</span><span class="nx">msg</span><span class="p">,</span> <span class="nx">level</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">levels</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">warning</span><span class="o">:</span> <span class="s1">&#39;alert&#39;</span><span class="p">,</span>
        <span class="nx">error</span><span class="o">:</span> <span class="s1">&#39;error&#39;</span><span class="p">,</span>
        <span class="nx">success</span><span class="o">:</span> <span class="s1">&#39;success&#39;</span><span class="p">,</span>
        <span class="nx">info</span><span class="o">:</span> <span class="s1">&#39;info&#39;</span>
    <span class="p">},</span>
    <span class="nx">source</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#message_template&#39;</span><span class="p">).</span><span class="nx">html</span><span class="p">(),</span>
    <span class="nx">template</span> <span class="o">=</span> <span class="nx">Handlebars</span><span class="p">.</span><span class="nx">compile</span><span class="p">(</span><span class="nx">source</span><span class="p">),</span>
    <span class="nx">context</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;tags&#39;</span><span class="o">:</span> <span class="nx">levels</span><span class="p">[</span><span class="nx">level</span><span class="p">],</span>
        <span class="s1">&#39;message&#39;</span><span class="o">:</span> <span class="nx">msg</span>
    <span class="p">},</span>
    <span class="nx">html</span> <span class="o">=</span> <span class="nx">template</span><span class="p">(</span><span class="nx">context</span><span class="p">);</span>

    <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#message_area&quot;</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="nx">html</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">django_block_message</span><span class="p">(</span><span class="nx">msg</span><span class="p">,</span> <span class="nx">level</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">source</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#message_block_template&quot;</span><span class="p">).</span><span class="nx">html</span><span class="p">(),</span>
        <span class="nx">template</span> <span class="o">=</span> <span class="nx">Handlebars</span><span class="p">.</span><span class="nx">compile</span><span class="p">(</span><span class="nx">source</span><span class="p">),</span>
        <span class="nx">context</span> <span class="o">=</span> <span class="p">{</span><span class="nx">level</span><span class="o">:</span> <span class="nx">level</span><span class="p">,</span> <span class="nx">body</span><span class="o">:</span> <span class="nx">msg</span><span class="p">},</span>
        <span class="nx">html</span> <span class="o">=</span> <span class="nx">template</span><span class="p">(</span><span class="nx">context</span><span class="p">);</span>

    <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#message_area&quot;</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="nx">html</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="section" id="ajax-views">
<h2>Ajax Views</h2>
<div class="highlight"><pre><span class="x">class NavigationItemAjaxSortView(LoginRequiredMixin, PermissionRequiredMixin,</span>
<span class="x">    View):</span>

<span class="x">    permission_required = &quot;navigations.change_navigation&quot;</span>

<span class="x">    def post(self, request):</span>
<span class="x">        pk = request.POST.get(&quot;pk&quot;, None)</span>

<span class="x">        if pk:</span>
<span class="x">            nav_item = get_object_or_404(NavigationItem, pk=pk)</span>
<span class="x">            form = NavigationItemForm(request.POST, instance=nav_item)</span>
<span class="x">            if form.is_valid():</span>
<span class="x">                form.save()</span>
<span class="x">                return HttpResponse(json.dumps(&quot;success&quot;),</span>
<span class="x">                    mimetype=&quot;application/json&quot;)</span>
<span class="x">            return HttpResponseForbidden(json.dumps(form.errors),</span>
<span class="x">                mimetype=&quot;application/json&quot;)</span>
<span class="x">        raise Http404</span>
</pre></div>
</div>

    </article>

	
	<section>
		<header>
			<h1>Comments</h1>
		</header>
		<div id="disqus_thread"></div>
	</section>
	


            </div>
        </div>
        <footer><p>&copy; Brack3t. All rights reserved. <a href=".././feeds/all.atom.xml">ATOM feed</a></p></footer>
    </div> <!-- /container -->

    <!-- Le javascript
    ================================================== -->

    <!-- Placed at the end of the document so the pages load faster -->
    <script src=".././brack3t-theme/assets/jquery-1.7.1.min.js"></script>
    <script src=".././brack3t-theme/assets/jquery.slabtext.min.js"></script>
    <script src=".././brack3t-theme/assets/jquery.fittext.js"></script>
    <script src=".././brack3t-theme/assets/highlight.pack.js"></script>
    <script>
        $(function() {
            $(".slabtext").slabText();
            $(".fittext").fitText(0.8);
            $(".highlight pre").each(function(i, e) {hljs.highlightBlock(e, "    ")});
        });
    </script>
  </body>
</html>
